service: hogwards-api

provider:
  name: aws
  runtime: python3.7
  memorySize: 128
  stage: ${opt:stage, self:custom.defaultStage}
  # profile: ${opt:profile, self:custom.defaultProfile}
  region: ${opt:region, self:custom.defaultRegion}
  logRetentionInDays: 30
  tags:
    Environment: ${self:provider.stage}
    ApplicationName: ${self:custom.tags.ApplicationName}
    # BillingGroup: ${self:custom.tags.BillingGroup}
  # iamRoleStatements:
  #   - Effect: Allow
  #     Action:
  #       - KMS:Decrypt
  #     Resource: ${self:custom.kmsSecrets.keyArn}

custom:
  defaultStage: dev
  # defaultProfile: arduino
  defaultRegion: eu-west-1
  tags:
    ApplicationName: hogwards-api  

functions:
  # api:
  #   handler: functions/api.handler
  #   events:
  #     - http:
  #         path: v1/{proxy+}
  #         method: ANY
  sync:
    handler: functions/publish-latest-grades.handler
    events:
      - schedule:
          name: ${self:service}-${opt:stage, self:provider.stage}-publish-latest-grades
          rate: cron(0/10 7-16 ? * MON-FRI *) # Run every 10 minutes Monday through Friday between 7:00 am and 3:50 pm (UTC)
          # disable until we're ready to test with real sensors
          enabled: false
